# 功能特性详解

## 一、用户系统

### 1. 用户注册
- 用户名唯一性验证
- 邮箱格式验证
- 密码 bcrypt 加密存储
- 注册后自动登录

### 2. 用户登录
- 用户名/密码验证
- JWT Token 认证机制
- Token 有效期 7 天
- 自动刷新用户状态

### 3. 权限管理
- 基于 JWT 的身份验证
- 每个请求都会验证 Token
- Token 过期自动跳转登录
- 只能管理自己的题库和题目

## 二、题库管理

### 1. 创建题库
**功能说明**：用户可以创建自己的题库分类

**使用场景**：
- 考研政治题库
- JavaScript 面试题
- 驾照考试题库
- 英语单词练习

**操作步骤**：
1. 登录后进入仪表盘
2. 点击"创建新题库"按钮
3. 输入题库标题和描述
4. 点击"创建"完成

**技术实现**：
- 前端：Modal 弹窗表单
- 后端：`POST /api/quiz-sets`
- 数据库：插入 quiz_sets 表，关联 owner_id

### 2. 题库列表
**功能说明**：以卡片形式展示所有题库

**显示信息**：
- 题库标题
- 题库描述
- 题目数量
- 创建时间

**操作按钮**：
- 开始刷题：进入练习模式
- 管理题目：添加/编辑题目
- 删除：删除整个题库（需确认）

### 3. 题库统计
- 自动统计每个题库的题目数量
- 使用 SQL COUNT 聚合查询
- 实时更新题目数量

## 三、题目管理（核心功能）

### 1. 动态添加题目

**这是整个平台的核心功能**，实现了用户自定义输入题目的需求。

#### 题目内容输入
- 大型文本框支持多行题目
- 支持长文本题目
- 实时验证必填项

#### 题目类型选择
- **单选题**：只能标记一个正确答案
- **多选题**：可以标记多个正确答案
- 自动验证答案数量

#### 动态选项管理（关键实现）

**初始状态**：
- 默认提供 2 个空选项
- 每个选项包含：
  - 复选框（标记是否为正确答案）
  - 文本输入框（输入选项内容）
  - 删除按钮（删除该选项）

**添加选项**：
- 点击"+ 添加选项"按钮
- 动态在列表末尾增加新选项
- 选项序号自动递增（A, B, C, D...）
- 无数量上限

**删除选项**：
- 点击选项右侧的"删除"按钮
- 至少保留 2 个选项
- 删除后自动重新排序

**标记正确答案**：
- 勾选复选框标记正确答案
- 单选题模式：勾选一个自动取消其他
- 多选题模式：可以勾选多个
- 至少需要一个正确答案

**技术实现**：
```javascript
// 前端状态管理
const [options, setOptions] = useState([
  { text: '', isCorrect: false },
  { text: '', isCorrect: false }
]);

// 添加选项
const handleAddOption = () => {
  setOptions([...options, { text: '', isCorrect: false }]);
};

// 删除选项
const handleRemoveOption = (index) => {
  if (options.length <= 2) return;
  setOptions(options.filter((_, i) => i !== index));
};

// 修改选项
const handleOptionChange = (index, field, value) => {
  const newOptions = [...options];
  newOptions[index][field] = value;
  setOptions(newOptions);
};
```

#### 答案解析
- 可选字段
- 支持多行文本
- 在答题后显示给用户

#### 数据提交

**前端验证**：
1. 题目内容不能为空
2. 至少 2 个有效选项
3. 至少一个正确答案

**后端事务处理**：
```javascript
// 使用数据库事务确保数据一致性
await client.query('BEGIN');

// 1. 插入题目
const question = await insertQuestion(...);

// 2. 循环插入所有选项
for (const option of options) {
  await insertOption(question.id, option);
}

await client.query('COMMIT');
```

### 2. 题目列表展示

**显示内容**：
- 题目序号和内容
- 题目类型（单选/多选）
- 所有选项（正确答案标记 ✓）
- 答案解析
- 操作按钮

**操作功能**：
- 删除题目（需确认）
- 未来可扩展：编辑题目

### 3. 题目编辑（已实现 API）

**API 支持**：
- `PUT /api/questions/:questionId`
- 支持更新题目和选项
- 使用事务保证一致性

**前端待实现**：
- 编辑表单（与创建表单类似）
- 预填充现有数据
- 提交更新请求

## 四、刷题功能

### 1. 练习模式

**显示内容**：
- 题库标题
- 当前进度（第几题/总题数）
- 题目内容
- 选项列表

**交互逻辑**：
- 点击选项进行选择
- 单选题：选择新选项自动取消旧选项
- 多选题：可以多次点击勾选/取消
- 选中状态高亮显示

### 2. 答案提交

**提交验证**：
- 至少选择一个选项才能提交
- 提交前可以修改答案

**即时反馈**：
- 显示是否答对（✓/✗）
- 正确选项标记为绿色
- 错误选项标记为红色
- 显示答案解析

**技术实现**：
```javascript
// 后端验证逻辑
const correctOptionIds = options
  .filter(opt => opt.is_correct)
  .map(opt => opt.option_id);

const isCorrect =
  selectedSet.size === correctSet.size &&
  [...selectedSet].every(id => correctSet.has(id));
```

### 3. 进度控制

**下一题**：
- 提交答案后才能进入下一题
- 重置选择状态
- 加载新题目

**进度显示**：
- 实时显示当前是第几题
- 显示实时正确率

### 4. 结果统计

**统计信息**：
- 总题数
- 答对题数
- 正确率百分比

**后续操作**：
- 再来一次：重新开始练习
- 返回题库：回到题库列表

## 五、数据统计

### 1. 实时统计

**练习中统计**：
- 每答一题更新统计
- 显示累计正确率
- 显示已答题数

**技术实现**：
```javascript
const [stats, setStats] = useState({ correct: 0, total: 0 });

// 提交答案后更新
setStats({
  correct: stats.correct + (result.isCorrect ? 1 : 0),
  total: stats.total + 1
});
```

### 2. 历史记录

**数据库存储**：
- user_progress 表记录每次答题
- 包含：用户ID、题库ID、题目ID、是否正确、答题时间

**API 支持**：
- `GET /api/quiz-sets/:setId/stats`
- 返回该用户在该题库的统计数据

**计算逻辑**：
```sql
SELECT
  COUNT(*) as total_attempts,
  SUM(CASE WHEN is_correct THEN 1 ELSE 0 END) as correct_count,
  ROUND(AVG(CASE WHEN is_correct THEN 100 ELSE 0 END), 2) as accuracy
FROM user_progress
WHERE user_id = ? AND quiz_set_id = ?
```

## 六、安全特性

### 1. 密码安全
- bcrypt 加密（salt rounds = 10）
- 密码哈希存储
- 原始密码永不存储

### 2. 认证安全
- JWT Token 机制
- Token 签名验证
- 自动过期机制

### 3. 权限控制
- 每个 API 都验证用户身份
- 用户只能访问自己的数据
- 数据库级别的用户隔离

### 4. 输入验证
- 前端表单验证
- 后端数据验证
- SQL 注入防护（使用参数化查询）

## 七、用户体验优化

### 1. 响应式设计
- Grid 布局自适应
- 移动端友好
- 流畅的动画过渡

### 2. 加载状态
- Loading 提示
- 错误提示
- 成功反馈

### 3. 操作确认
- 删除操作需要确认
- 防止误操作
- 友好的错误提示

### 4. 状态管理
- React Context 全局状态
- 自动刷新数据
- 实时更新界面

## 八、未来扩展方向

### 1. 题目增强
- 图片上传（题目配图）
- 富文本编辑器
- 代码高亮显示
- 数学公式支持

### 2. 练习模式
- 随机模式
- 错题模式
- 定时考试
- 模拟考试

### 3. 社交功能
- 题库分享
- 多人协作
- 题目评论
- 点赞收藏

### 4. 数据分析
- 学习曲线
- 知识点分析
- 薄弱环节识别
- 学习建议

### 5. 导入导出
- Excel 批量导入
- JSON 格式导出
- 题库模板
- 打印功能

## 九、性能优化

### 1. 数据库优化
- 建立索引（已实现）
- 查询优化
- 连接池管理

### 2. 前端优化
- 代码分割
- 懒加载
- 缓存策略
- 虚拟滚动（大量题目）

### 3. 网络优化
- API 响应压缩
- 图片压缩
- CDN 加速

## 十、开发友好

### 1. 代码结构
- 清晰的目录组织
- 模块化设计
- 关注点分离

### 2. 错误处理
- 完善的错误提示
- 日志记录
- 调试友好

### 3. 文档完善
- README 使用说明
- API 接口文档
- 快速启动指南
- 功能特性说明

---

**总结**：本平台的核心优势在于**真正实现了用户自定义题目**的需求，通过动态表单和灵活的数据结构，让用户可以轻松创建各种类型的题库和题目，满足不同学习场景的需求。
